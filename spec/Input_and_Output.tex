\sekshun{Input and Output}
\label{Input_and_Output}

Chapel provides a predefined \chpl{file} class to handle input and
output to files using procedures \chpl{read}, \chpl{readln},
\chpl{write}, and \chpl{writeln}.

\section{The {\em file} type}
\index{file type}

The file class contains the following fields:
\begin{itemize}
\item
The \chpl{filename} field is a \chpl{string} that contains the name of
the file.
\item
The \chpl{mode} field is a \chpl{FileAccessMode} enum value that indicates
whether the file is being read or written.
\item
The \chpl{path} field is a \chpl{string} that contains the path of the
file.
\item
The \chpl{style} field can be set to \chpl{text} or \chpl{binary} to
specify that reading from or writing to the file should be done with
text or binary formats.
\end{itemize}
These fields can be modified any time that the file is closed.

The \chpl{mode} field supports the following \chpl{FileAccessMode} values:
\begin{itemize}
\item
\chpl{FileAccessMode.read} The file can be read.
\item
\chpl{FileAccessMode.write} The file can be written.
\end{itemize}

The file type supports the following methods:
\index{file type!methods}
\begin{itemize}
\item
The \chpl{open()} method opens the file for reading and/or writing.
\item
The \chpl{close()} method closes the file for reading and/or writing.
\item
The \chpl{isOpen} method returns true if the file is open for reading
and/or writing, and otherwise returns false.
\item
The \chpl{eof} method returns true if the file is at its end-of-file
position and returns false otherwise.
\item
The \chpl{flush()} method flushes the file, finishing outstanding
reading and writing.
\end{itemize}

Additionally, the file type supports the
methods \chpl{read}, \chpl{readln}, \chpl{write}, and \chpl{writeln} for 
input and output as discussed in~\rsec{filewrite} and~\rsec{fileread}.

\section{Standard files {\em stdout}, {\em stdin}, and {\em stderr}}
\index{file type!standard files stdin, stdout, stderr}
\index{stdin@\chpl{stdin}}
\index{stdout@\chpl{stdout}}
\index{stderr@\chpl{stderr}}

The files \chpl{stdout}, \chpl{stdin}, and \chpl{stderr} are
predefined and map to standard output, standard input, and standard
error as implemented in a platform dependent fashion.

\section{The procedures {\em write}, {\em writeln}, {\em read}, and {\em readln}}
\index{writeln@\chpl{writeln}}
\index{write@\chpl{write}}
\index{read@\chpl{read}}
\index{readln@\chpl{readln}}
\index{read}
\index{write}

The predefined procedure \chpl{write} takes an arbitrary number of
arguments and prints each out in turn to \chpl{stdout}.  The predefined
procedure \chpl{writeln} is identical to \chpl{write} except that it
outputs an additional {\em end-of-line} character after writing out
the argument expressions.  Both of these procedures will generate their
output atomically with respect to other calls to these procedures from
other tasks.

The predefined procedure \chpl{read} takes an arbitrary number of
variable expressions and reads into each in turn from \chpl{stdin}.
Any whitespace is skipped over and is used only to separate one
argument from the next.  The predefined procedure \chpl{readln} is
identical except that upon reading all of its arguments it scans ahead
in the input stream until just after the next {\em end-of-line}
character.

The \chpl{read} and \chpl{readln} procedures are also defined to take
an arbitrary number of types as arguments.  In this case, the
procedures read an expression of each argument type.  In the event that
a single type is specified, the return value is the value that was
read; if multiple types are specified, a tuple of the values is
returned.

These procedures are wrappers for the methods on files described next.

\begin{chapelexample}{writeln.chpl}
The \chpl{writeln} wrapper procedure allows for a simple implementation
of the {\em Hello-World} program:
\begin{chapel}
writeln("Hello, World!");
\end{chapel}
\begin{chapeloutput}
Hello, World!
\end{chapeloutput}
\end{chapelexample}

\begin{example}
The following code shows three ways to read values into a pair of
variables \chpl{x} and \chpl{y}:
\begin{chapel}
var x: int;
var y: real;

/* reading into variable expressions */
read(x, y);

/* reading via a single type argument */
x = read(int);
y = read(real);

/* reading via multiple type arguments */
(x, y) = read(int, real);
\end{chapel}
\end{example}

\section{User-Defined {\em writeThis} methods}

To define the output for a given type, the user must define a method
called \chpl{writeThis} on that type that takes a single argument of
\chpl{Writer} type.  If such a method does not exist, a default method is
created.

\section{The {\em write} and {\em writeln} method on files}
\label{filewrite}
\index{write!on files}

The \chpl{file} type supports methods \chpl{write} and \chpl{writeln}
for output.  These methods are defined to take an arbitrary number of
arguments.  Each argument is written in turn by calling
the \chpl{writeThis} method on that argument.
Default \chpl{writeThis} methods are bound to any type that the user
does not explicitly create one for.

A lock is used to ensure that output is serialized across multiple
tasks.

\subsection{The {\em write} and {\em writeln} method on strings}
\label{stringwrite}
\index{write!on strings}

The \chpl{write} and \chpl{writeln} methods can also be called on
strings to write the output to a string instead of a file.

\subsection{Generalized {\em write} and {\em writeln}}
\label{writer}
\index{Writer@\chpl{Writer}}

The \chpl{Writer} class contains no arguments and serves as a base
class to allow user-defined classes to be written to.  If a class is
defined to be a subclass of Writer, it must override
the \chpl{writeIt} method that takes a \chpl{string} as an argument.

\begin{chapelexample}{Writer.chpl}
The following code defines a subclass of \chpl{Writer} that overrides
the \chpl{writeIt} method to allow it to be written to.  It also
overrides the \chpl{writeThis} method to override the default way that
it is written.
\begin{chapel}
class C: Writer {
  var data: string;
  proc writeIt(s: string) {
    data += s.substring(1);
  }
  proc writeThis(x: Writer) {
    x.write(data);
  }
}

var c = new C();
c.write(41, 32, 23, 14);
writeln(c);
\end{chapel}
\begin{chapeloutput}
4321
\end{chapeloutput}
The \chpl{C} class filters the arguments sent to it, printing out only
the first letter.  The output to the above is thus \chpl{4321}.
\end{chapelexample}


\section{The {\em read} and {\em readln} methods on files}
\label{fileread}
\index{read!on files}

The \chpl{file} type supports \chpl{read} and \chpl{readln} methods.
The \chpl{read} method takes an arbitrary number of arguments, reading
in each argument from file.  The \chpl{readln} method also
takes an arbitrary number of arguments, reading in each argument
from a single line or multiple lines in the file and 
advancing the file pointer to the next line after the last argument 
is read.

The \chpl{file} type also supports overloaded methods \chpl{read}
and \chpl{readln} that take an arbitrary number of types as arguments.
These methods read values of the specified types from the file and
return them in a tuple.  If only one type is read, the value is not
returned in a tuple, but is returned directly.

\begin{example}
The following line of code reads a value of type \chpl{int} from
\chpl{stdin} and uses it to initialize variable \chpl{x} (causing
\chpl{x} to have an inferred type of \chpl{int}):
\begin{chapel}
var x = stdin.read(int);
\end{chapel}
\end{example}


\section{Default {\em read} and {\em write} methods}
\index{write!default methods}
\index{read!default methods}

Default \chpl{write} methods are created for all types for which a user
\chpl{write} method is not defined.  They have the following semantics:
\begin{itemize}
\item
{\bf arrays} Outputs the elements of the array in row-major order
where rows are separated by line-feeds and blank lines are used to
separate other dimensions.
\item
{\bf domains} Outputs the dimensions of the domain enclosed
by \chpl{[} and \chpl{]}.
\item
{\bf ranges} Outputs the lower bound of the range followed
by \chpl{..} followed by the upper bound of the range.  If the stride
of the range is not one, the output is additionally followed by the
word \chpl{by} followed by the stride of the range.
\item
{\bf tuples} Outputs the components of the tuple in order delimited
by \chpl{(} and \chpl{)}, and separated by commas.
\item
{\bf classes} Outputs the values within the fields of the class
prefixed by the name of the field and the character \chpl{=}.  Each
field is separated by a comma.  The output is delimited by \chpl{\{}
and \chpl{\}}.
\item
{\bf records} Outputs the values within the fields of the class
prefixed by the name of the field and the character \chpl{=}.  Each
field is separated by a comma.  The output is delimited by \chpl{(}
and \chpl{)}.
\end{itemize}

Default \chpl{read} methods are created for all types for which a user
\chpl{read} method is not defined.  The default \chpl{read} methods are
defined to read in the output of the default \chpl{write} method.
