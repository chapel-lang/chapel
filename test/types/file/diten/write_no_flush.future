feature request: when closing a file, close its channels first
