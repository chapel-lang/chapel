AST dump for ExternalArray after pass scopeResolve.
Module use list: ChapelStandard HaltWrappers 

{
  type chpl_opaque_array[181534] unknown _pid[181522] int(64)[13] unknown _instance[181526] c_void_ptr[141] unknown _unowned[181530] bool[10]
  type chpl_external_array[181551] unknown elts[181539] c_void_ptr[141] unknown num_elts[181543] uint(64)[107] unknown freer[181547] c_void_ptr[141]
  function chpl_make_external_array[181560](arg elt_size[181557] :
  uint(64)[107], arg num_elts[181563] :
  uint(64)[107]) : _unknown[43] "extern" "local args" "no fn body" "no return value for void"
  {
  }
  { scopeless type
    chpl_external_array[181551]
  }
  function chpl_make_external_array_ptr[181576](arg elts[181573] :
  c_void_ptr[141], arg num_elts[181579] :
  uint(64)[107]) : _unknown[43] "extern" "local args" "no fn body" "no return value for void"
  {
  }
  { scopeless type
    chpl_external_array[181551]
  }
  function chpl_make_external_array_ptr_free[181592](arg elts[181589] :
  c_void_ptr[141], arg num_elts[181595] :
  uint(64)[107]) : _unknown[43] "extern" "local args" "no fn body" "no return value for void"
  {
  }
  { scopeless type
    chpl_external_array[181551]
  }
  function chpl_free_external_array[181608](arg x[181605] :
  chpl_external_array[181551]) : void[4] "extern" "local args" "no fn body" "no return value for void"
  {
  }
  function chpl_call_free_func[181618](arg func[181615] :
  c_void_ptr[141], arg elts[181621] :
  c_void_ptr[141]) : void[4] "extern" "local args" "no fn body" "no return value for void"
  {
  }
  function makeArrayFromPtr[181632](arg value[181629] :
  c_ptr[193070](?), arg num_elts[181635] :
  uint(64)[107]) : _unknown[43] "no copy return"
  {
    unknown data[181646](181645 call chpl_make_external_array_ptr(181641 call _cast c_void_ptr[141] value[181629]) num_elts[181635])
    (181658 return(181657 call makeArrayFromExternArray data[181646](181654 call . value[181629] c"eltType")))
  }
  function makeArrayFromExternArray[181668](arg value[181665] :
  chpl_external_array[181551], arg eltType[181670]:_any[170](?)) : _unknown[43] "no copy return"
  {
    unknown dom[181698](181697 call(181673 call . defaultDist[93214] c"dsiNewRectangularDom")(rank = 1)(idxType = int(64)[13])(stridable = 0)(inds =(181694 call _build_tuple(181692 call #(181684 call chpl_build_low_bounded_range 0)(181689 call . value[181665] c"num_elts")))))
    (181707 call =(181703 call . dom[181698] c"_free_when_no_arrs") 1)
    unknown arr[181755](181754 'new'(181753 'to unmanaged class from unknown'(181752 call anymanaged DefaultRectangularArr[347545](?)(eltType = eltType[181670])(rank = 1)(idxType =(181717 call . dom[181698] c"idxType"))(stridable =(181722 call . dom[181698] c"stridable"))(dom = dom[181698])(data =(181738 call _cast(181737 call _ddata[11791](?) eltType[181670])(181731 call . value[181665] c"elts")))(externFreeFunc =(181744 call . value[181665] c"freer"))(externArr = 1)(_borrowed = 1))))
    (181766 call(181759 call . dom[181698] c"add_arr") arr[181755](locking = 0))
    (181772 return(181771 call _newArray arr[181755]))
  }
  function makeArrayFromOpaque[181782](arg value[181779] :
  chpl_opaque_array[181534], arg arrType[181784]:_any[170](?)) : _unknown[43] "no copy return"
  {
    unknown asArrType[181794](181792 call _cast(181791 'to nilable class from type' arrType[181784])(181787 call . value[181779] c"_instance"))
    if(181822 call _cond_test(181800 call == asArrType[181794] nil[38]))
    {
      (181820 call halt "nil array passed to makeArrayFromOpaque")
    }
    unknown asNonNilArrType[181832](181831 'try!-expr'(181829 call _cast arrType[181784] asArrType[181794]))
    unknown ret[181839](181838 call _newArray asNonNilArrType[181832])
    (181850 call =(181843 call . ret[181839] c"_pid")(181847 call . value[181779] c"_pid"))
    (181858 call =(181854 call . ret[181839] c"_unowned") 1)
    (181862 return ret[181839])
  }
  function convertToExternalArray[181874](in arg arr[181871] :
  (181868 call chpl__buildArrayRuntimeType nil[38])) : _unknown[43]
  {
    if(181927 call _cond_test(181891 call !(181890 call isExternArrEltType(181886 call . arr[181871] c"eltType"))))
    {
      (181925 call safeCastCheckHalt(181922 call + "Cannot build an external array that stores "(181920 call _cast string[24](181916 call . arr[181871] c"eltType"))))
      (329476 'used modules list'(181895 'use' HaltWrappers[197622]))
    }
    if(181983 call _cond_test(181942 call !(181941 call isIntegralType(181937 call .(181934 call . arr[181871] c"_dom") c"idxType"))))
    {
      (181980 call compilerError(181977 call + "cannot return an array with indices that are not " "integrals"))
    }
    if(182015 call _cond_test(181991 call .(181988 call . arr[181871] c"_dom") c"stridable"))
    {
      (182012 call compilerError "cannot return a strided array")
    }
    if(182050 call _cond_test(182027 call !=(182023 call .(182020 call . arr[181871] c"_dom") c"rank") 1))
    {
      (182047 call compilerError "cannot return an array with rank != 1")
    }
    if(182085 call _cond_test(182062 call !=(182058 call .(182055 call . arr[181871] c"_dom") c"low") 0))
    {
      (182082 call halt "cannot return an array when the lower bounds is not 0")
    }
    unknown externalArr[182106](182105 call chpl_make_external_array_ptr_free(182096 call c_ptrTo(182094 call arr[181871] 0))(182103 call _cast uint(64)[107](182099 call . arr[181871] c"size")))
    (182116 call =(182112 call . arr[181871] c"externArr") 1)
    (182126 call =(182122 call . arr[181871] c"_borrowed") 1)
    (182130 return externalArr[182106])
  }
  where {
    (181882 call ==(181880 call getExternalArrayType arr[181871]) chpl_external_array[181551])
  }
  { scopeless type
    chpl_external_array[181551]
  }
  function convertToExternalArray[182144](arg arr[182141] :
  (182138 call chpl__buildArrayRuntimeType nil[38])) : _unknown[43]
  {
    unknown ret[182155] chpl_opaque_array[181534]
    (182167 call =(182160 call . ret[182155] c"_pid")(182164 call . arr[182141] c"_pid"))
    (182181 call =(182171 call . ret[182155] c"_instance")(182179 call _cast c_void_ptr[141](182175 call . arr[182141] c"_value")))
    (182192 call =(182185 call . ret[182155] c"_unowned")(182189 call . arr[182141] c"_unowned"))
    if(182210 call _cond_test(182199 call !(182196 call . arr[182141] c"_unowned")))
    {
      (182206 call =(182202 call . arr[182141] c"_unowned") 1)
    }
    (182215 return ret[182155])
  }
  where {
    (182152 call ==(182150 call getExternalArrayType arr[182141]) chpl_opaque_array[181534])
  }
  { scopeless type
    chpl_opaque_array[181534]
  }
  function isExternArrEltType[182225](arg t[182223]:_any[170](?)) param : _unknown[43] "private"
  {
    if(182285 call _cond_test(182235 call &&(182230 call isPrimitive t[182223])(182233 call != t[182223] string[24])))
    {
      (182238 return 1)
    }
    {
      if(182280 call _cond_test(182243 call == t[182223] c_string[19]))
      {
        (182246 return 1)
      }
      {
        if(182276 call _cond_test(182267 'is extern type' t[182223]))
        {
          (182269 return 1)
        }
        {
          (182273 return 0)
        }
      }
    }
  }
  function getExternalArrayType[182297](arg arg[182295]:_any[170](?)) type : _unknown[43]
  {
    if(182349 call _cond_test(182304 call !(182303 call isArrayType(182301 'typeof' arg[182295]))))
    {
      (182324 call compilerError "must call with an array")
    }
    {
      if(182344 call _cond_test(182335 call(182331 call .(182328 call . arg[182295] c"_value") c"isDefaultRectangular")))
      {
        (182337 return chpl_external_array[181551])
      }
      {
        (182341 return chpl_opaque_array[181534])
      }
    }
  }
  function getExternalArrayType[182360](arg arg[182358]:_any[170](?)) type : _unknown[43]
  {
    if(182408 call _cond_test(182366 call !(182365 call isArrayType arg[182358])))
    {
      (182371 call compilerError "must call with an array")
    }
    {
      unknown _instanceType[182379] "type variable"(182378 'static field type' arg[182358] "_instance")
      unknown borrowedAlt[182387] "type variable"(182386 call _to_borrowed _instanceType[182379])
      if(182404 call _cond_test(182395 call(182391 call . borrowedAlt[182387] c"isDefaultRectangular")))
      {
        (182397 return chpl_external_array[181551])
      }
      {
        (182401 return chpl_opaque_array[181534])
      }
    }
  }
  function cleanupOpaqueArray[182421](arg arr[182418] :
  chpl_opaque_array[181534]) : _unknown[43] "export" "local args" "no return value for void"
  {
    unknown cleanup[182432](182430 call _cast unmanaged BaseArr?[390007](182424 call . arr[182418] c"_instance"))
    if(182448 call _cond_test cleanup[182432])
    {
      (182446 call _do_destroy_arr(182439 call . arr[182418] c"_unowned")(182444 call postfix! cleanup[182432]))
    }
  }
  (329474 'used modules list'(181517 'use' ChapelStandard[19734]))
}